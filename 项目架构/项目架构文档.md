# Stock_RNN 智能股票交易系统 - 完整架构文档

> 更新时间：2026-01-01
> 版本：v3.0 (重构版)

---

# 目录

1. [项目概述](#一项目概述)
2. [技术栈](#二技术栈)
3. [目录结构](#三目录结构)
4. [核心模块详解](#四核心模块详解)
5. [数据处理流程](#五数据处理流程)
6. [数据库设计](#六数据库设计)
7. [Web应用架构](#七web应用架构)
8. [用户认证系统](#八用户认证系统)
9. [改进建议](#九改进建议)

---

# 一、项目概述

**Stock_RNN** 是一个基于深度学习的量化交易系统，提供从数据采集、技术分析、模型预测到自动交易的完整解决方案。

## 1.1 核心功能

| 模块 | 功能描述 |
|------|---------|
| 数据采集 | 多源股票数据下载（东方财富、雪球、Yahoo等） |
| 技术分析 | MACD、布林带、周期分析等技术指标计算 |
| 深度学习 | CNN模型进行趋势预测和分类 |
| 自动交易 | 基于信号的自动化交易执行 |
| Web界面 | Flask Web应用提供可视化管理 |
| 用户认证 | 完整的用户注册、登录、权限管理 |

## 1.2 项目特点

1. **多源数据集成**：支持7个不同的数据源，保证数据可用性
2. **完整交易链路**：从数据采集到自动执行的闭环系统
3. **深度学习应用**：CNN模型进行趋势预测
4. **技术指标丰富**：MACD、布林带、周期分析等
5. **分层架构清晰**：路由-服务-仓库-数据访问四层架构
6. **可视化完善**：Web界面 + Matplotlib + Plotly
7. **安全配置管理**：敏感信息通过环境变量管理
8. **单元测试覆盖**：pytest测试框架保障代码质量

---

# 二、技术栈

## 2.1 后端技术

| 类别 | 技术 |
|------|------|
| Web框架 | Flask |
| ORM | SQLAlchemy |
| 数据库 | MySQL |
| 任务调度 | APScheduler |

## 2.2 数据处理

| 类别 | 技术 |
|------|------|
| 数据分析 | Pandas, NumPy, SciPy |
| 数据可视化 | Matplotlib, Plotly |
| 数据爬取 | requests, Selenium, BeautifulSoup, pytdx |

## 2.3 机器学习

| 类别 | 技术 |
|------|------|
| 深度学习框架 | Keras + TensorFlow |
| 模型架构 | CNN (卷积神经网络) |

## 2.4 自动化交易

| 类别 | 技术 |
|------|------|
| GUI自动化 | pyautogui, pywinauto |
| 图像识别 | OpenCV |

---

# 三、目录结构

```
Stock_RNN/
├── App/                              # Flask应用主体
│   ├── __init__.py                   # 应用工厂
│   ├── exts.py                       # 数据库扩展
│   ├── codes/                        # 核心业务代码
│   │   ├── downloads/                # 数据下载模块
│   │   │   ├── DlEastMoney.py        # 东方财富（向后兼容入口）
│   │   │   ├── eastmoney/            # 东方财富子模块 ★新增
│   │   │   │   ├── http_client.py    # HTTP请求封装
│   │   │   │   ├── data_parser.py    # 数据解析
│   │   │   │   ├── stock_downloader.py # 股票下载器
│   │   │   │   ├── fund_downloader.py  # 基金下载器
│   │   │   │   └── board_downloader.py # 板块下载器
│   │   │   ├── DlXueQiu.py           # 雪球数据源
│   │   │   ├── DlYahoo.py            # Yahoo数据源
│   │   │   └── DlPytdx.py            # 通达信数据源
│   │   ├── RnnModel/                 # RNN神经网络模型
│   │   │   ├── RnnRunModel.py        # 向后兼容入口
│   │   │   ├── rnn_base.py           # 基类 ★新增
│   │   │   ├── data_loader.py        # 数据加载 ★新增
│   │   │   ├── model_predictor.py    # 模型预测 ★新增
│   │   │   ├── data_updater.py       # 数据更新 ★新增
│   │   │   ├── trade_executor.py     # 交易执行 ★新增
│   │   │   └── prediction_engine.py  # 预测引擎 ★新增
│   │   ├── Signals/                  # 技术指标信号
│   │   ├── Evaluation/               # 股票评估分析
│   │   ├── AutoTrade/                # 自动化交易
│   │   ├── TrendDistinguish/         # 趋势识别
│   │   ├── MySql/                    # 数据库访问层
│   │   ├── parsers/                  # 数据解析器
│   │   └── utils/                    # 工具函数
│   │       ├── Normal.py             # 向后兼容入口
│   │       ├── math_utils.py         # 数学函数 ★新增
│   │       ├── data_processing.py    # 数据处理 ★新增
│   │       ├── file_io.py            # 文件IO ★新增
│   │       └── stock_utils.py        # 股票工具 ★新增
│   ├── config/                       # 配置模块 ★新增
│   │   └── secrets.py                # 敏感信息管理
│   ├── models/                       # ORM模型
│   │   ├── data/                     # 数据模型
│   │   ├── strategy/                 # 策略模型
│   │   ├── trade/                    # 交易模型
│   │   └── auth/                     # 认证模型
│   ├── repositories/                 # 数据仓库层 ★新增
│   │   ├── base_repository.py        # 基础仓库
│   │   ├── stock_repository.py       # 股票仓库
│   │   ├── trade_repository.py       # 交易仓库
│   │   └── model_repository.py       # 模型仓库
│   ├── routes/                       # Flask路由
│   ├── services/                     # 业务逻辑层
│   │   ├── base.py                   # 服务基类 ★新增
│   │   ├── report_service.py         # 报告服务 ★完善
│   │   └── risk_service.py           # 风险服务 ★完善
│   ├── templates/                    # HTML模板
│   ├── static/                       # 静态资源
│   └── utils/                        # 工具函数
│       └── path_manager.py           # 路径管理 ★新增
├── tests/                            # 单元测试 ★新增
│   ├── conftest.py                   # pytest配置
│   ├── test_utils/                   # 工具测试
│   ├── test_services/                # 服务测试
│   └── test_repositories/            # 仓库测试
├── data/                             # 数据存储
│   ├── data/                         # 股票数据
│   │   ├── 15m/                      # 15分钟K线
│   │   ├── 15m_standardized/         # 标准化数据
│   │   ├── quarters/                 # 按季度存储1分钟数据
│   │   └── daily/                    # 日线数据
│   └── RnnData/                      # RNN训练数据（按月份）
├── scripts/                          # 脚本文件
├── config.py                         # 配置文件
├── run.py                            # 启动入口
├── requirements.txt                  # 依赖管理 ★新增
├── requirements-dev.txt              # 开发依赖 ★新增
├── .env.example                      # 环境变量模板 ★新增
└── 项目架构/                         # 架构文档
```

---

# 四、核心模块详解

## 4.1 数据下载模块

位置：`App/codes/downloads/`

| 文件 | 数据源 | 说明 |
|------|--------|------|
| DlEastMoney.py | 东方财富 | 主要数据源（向后兼容入口） |
| DlXueQiu.py | 雪球 | 备用数据源 |
| DlYahoo.py | Yahoo Finance | 国际市场数据 |
| DlSina.py | 新浪财经 | 实时行情 |
| DlPytdx.py | 通达信 | pytdx库封装 |
| DlFundsAwkward.py | 基金数据 | 基金持仓爬取 |

### 东方财富子模块 (v3.0 新增)

位置：`App/codes/downloads/eastmoney/`

| 文件 | 功能 | 说明 |
|------|------|------|
| http_client.py | HTTP请求 | HeaderRotator轮换、Selenium降级 |
| data_parser.py | 数据解析 | JSON解析、DataFrame处理 |
| stock_downloader.py | 股票下载 | pytdx/API/Selenium多策略 |
| fund_downloader.py | 基金下载 | 基金数据抓取 |
| board_downloader.py | 板块下载 | 行业/概念板块数据 |

```python
# 使用示例
from App.codes.downloads.eastmoney import StockDownloader, FundDownloader

# 下载股票1分钟数据
df = StockDownloader.stock_1m_days('600000', days=5)

# 下载基金持仓
holdings = FundDownloader.get_fund_holdings('510050')
```

### 数据验证规则
- 必需列：date, open, close, high, low, volume, money
- 自动处理重复数据和时间戳格式

### 数据重复避免机制

系统采用三层重复避免机制：

1. **CSV文件层面**：基于日期的pandas去重
2. **通用保存层**：文件级别的数据合并去重
3. **数据库层**：插入/更新策略避免重复

```python
# 基于日期去重，保留最新数据
combined_data = pd.concat([existing_data, new_data]).drop_duplicates(subset=['date'], keep='last')
```

## 4.2 技术指标模块

位置：`App/codes/Signals/`

### MACD计算 (MacdSignal.py)

```
参数：s=12, m=20, l=30, em=9

EMA_short = close.rolling(12).mean()   # 短期均线
EMA_mid   = close.rolling(20).mean()   # 中期均线
EMA_long  = close.rolling(30).mean()   # 长期均线

DIF  = EMA_short - EMA_long            # 主差值
DifSm = EMA_short - EMA_mid            # 短期DIF
DifMl = EMA_mid - EMA_long             # 中期DIF
DEA  = DIF.rolling(9).mean()           # 信号线
MACD = (DIF - DEA) * 2                 # 柱状图
```

### 布林带计算 (BollingerSignal.py)

```
参数：ma_mid=20, std_dev=2

BollMid = close.rolling(20).mean()     # 中轨
BollStd = close.rolling(20).std()      # 标准差
BollUp  = BollMid + 2 * BollStd        # 上轨
BollDn  = BollMid - 2 * BollStd        # 下轨
StopLoss = BollDn - 2 * BollStd        # 止损位
```

### 信号计算体系

项目有两套信号计算体系：

| 特性 | 简化版 | 完整版(CountMACD) |
|------|--------|--------|
| 复杂度 | 简单 | 复杂 |
| 信号质量 | 基础 | 高质量 |
| 信号数量 | 多 | 少但精准 |
| 适用场景 | 快速处理 | 精确分析 |

**简化版信号标准**：
- MACD > 0 → 上涨信号 (Signal = 1)
- MACD < 0 → 下跌信号 (Signal = -1)

**完整版信号标准**：
- 上涨信号：MACD从负转正 + DifMl>0且DifSm>0连续7个周期
- 下跌信号：MACD从正转负 + DifMl<0且DifSm<0连续7个周期

## 4.3 RNN模型模块

位置：`App/codes/RnnModel/`

### 模型架构 (CNN)

```
Input (30, 30, 1)
    ↓
Conv2D(6, kernel=5x5) + ReLU
    ↓
AveragePooling2D(2x2)
    ↓
Conv2D(16, kernel=5x5) + ReLU
    ↓
AveragePooling2D(2x2)
    ↓
Flatten
    ↓
Dense(120) + ReLU
    ↓
Dense(84) + ReLU
    ↓
Dense(1) - 输出预测值
```

### 训练配置
- 损失函数：MSE
- 优化器：Adam (lr=0.01)
- 批大小：30
- Epochs：500（首次）/ 100（续训）

### 模块结构 (v3.0 重构)

| 文件 | 类 | 功能 |
|------|-----|------|
| rnn_base.py | RnnBase | 共享变量和基础配置 |
| data_loader.py | ModelData | 数据加载和预处理 |
| model_predictor.py | DlModel | 模型预测逻辑 |
| data_updater.py | UpdateData | 数据更新操作 |
| trade_executor.py | TradingAction | 交易执行逻辑 |
| prediction_engine.py | PredictionCommon | 组合预测引擎 |
| RnnRunModel.py | - | 向后兼容入口 |

```python
# 继承关系
RnnBase
    ├── ModelData(RnnBase)      # 数据加载
    ├── DlModel(RnnBase)        # 模型预测
    └── UpdateData(RnnBase)     # 数据更新
            ↓
    PredictionCommon(ModelData, DlModel, UpdateData)  # 组合类
```

### 其他文件

| 文件 | 功能 |
|------|------|
| RnnCreationModel.py | 模型创建和编译 |
| RnnCreationData.py | 训练数据创建 |
| ProcessTrainingData.py | 训练数据处理 |

## 4.4 数据标准化模块

### 标准化方法

**方法1: Z-score标准化**
```python
mean, std = df[col].mean(), df[col].std()
df[col] = (df[col] - mean) / std
```

**方法2: MAD + Min-Max标准化**
```python
high = med + (3 * 1.4826 * mad)
low = med - (3 * 1.4826 * mad)
data[column] = (data[column] - low) / (high - low)
```

### 标准化处理的列

- 基础OHLCV：open, high, low, close, volume
- 成交量指标：Daily1mVolMax1/5/15, Bar1mVolMax1/5, Cycle1mVolMax1/5
- 周期指标：CycleLengthMax, CycleLengthPerBar, preCycleLengthMax
- 振幅指标：CycleAmplitudeMax, CycleAmplitudePerBar

## 4.5 数据仓库层 (v3.0 新增)

位置：`App/repositories/`

### 基础仓库

```python
class BaseRepository(Generic[T]):
    """通用CRUD操作"""
    def get_by_id(self, id: int) -> Optional[T]
    def get_all(self, limit=None, offset=None) -> List[T]
    def create(self, **kwargs) -> Optional[T]
    def update(self, id: int, **kwargs) -> Optional[T]
    def delete(self, id: int) -> bool
    def upsert(self, lookup_keys: List[str], **kwargs) -> Optional[T]
```

### 专用仓库

| 仓库 | 功能 |
|------|------|
| StockRepository | 股票数据CRUD、CSV读写、批量插入 |
| TradeRepository | 交易记录管理、持仓查询 |
| ModelRepository | 模型文件管理、训练记录 |

```python
# 使用示例
from App.repositories import StockRepository

repo = StockRepository()
records = repo.get_by_date_range('600000', '2024-01-01', '2024-12-31')
df = repo.to_dataframe(records)
repo.save_to_csv('600000', data_type='15m')
```

## 4.6 服务层 (v3.0 完善)

位置：`App/services/`

### 统一响应格式

```python
from App.services.base import ServiceResponse

# 成功响应
response = ServiceResponse.ok(data={'result': 123}, message='操作成功')

# 失败响应
response = ServiceResponse.fail(message='操作失败', error_code='1001')

# 从异常创建
response = ServiceResponse.from_exception(e)

# 转换为字典
result = response.to_dict()
# {'success': True, 'message': '...', 'data': {...}, 'error_code': None}
```

### 风险服务

| 方法 | 功能 |
|------|------|
| calculate_var() | VaR风险值计算（历史模拟/参数法） |
| check_stop_loss() | 止损检查 |
| check_take_profit() | 止盈检查 |
| calculate_position_size() | 仓位计算 |
| evaluate_portfolio_risk() | 组合风险评估 |

### 报告服务

| 方法 | 功能 |
|------|------|
| generate_daily_report() | 日报生成 |
| generate_weekly_summary() | 周报生成 |
| generate_trade_analysis() | 交易分析 |
| generate_performance_report() | 业绩报告 |

## 4.7 自动交易模块

位置：`App/codes/AutoTrade/`

- 使用 pywinauto 和 pyautogui 控制交易软件
- 基于 OpenCV 模板匹配定位UI元素
- 自动执行买入/卖出操作

---

# 五、数据处理流程

## 5.1 整体流程

```
┌─────────────────┐
│  外部数据源     │  东方财富 / 雪球 / Yahoo
└────────┬────────┘
         ↓
┌─────────────────┐
│  数据下载      │  DlEastMoney.py
└────────┬────────┘
         ↓
┌─────────────────┐
│  数据验证清洗   │  download_utils.py
└────────┬────────┘
         ↓
┌─────────────────┐
│  技术指标计算   │  MacdSignal + BollingerSignal
└────────┬────────┘
         ↓
┌─────────────────┐
│  特征工程      │  归一化、异常值处理
└────────┬────────┘
         ↓
┌─────────────────┐
│  数据库存储     │  MySQL (Stock1m, Stock15m)
└────────┬────────┘
         ↓
┌─────────────────┐
│  RNN训练数据    │  RnnCreationData
└────────┬────────┘
         ↓
┌─────────────────┐
│  模型训练      │  RnnCreationModel
└────────┬────────┘
         ↓
┌─────────────────┐
│  预测与交易     │  RnnRunModel + AutoTrading
└─────────────────┘
```

## 5.2 1分钟数据下载流程

```
complete_download_process(stock_code, days)
├── download_1m_by_type()           # 下载1分钟数据
├── save_1m_to_csv()                # 按季度分组保存
├── ResampleData.resample_1m_data() # 转换为15分钟
├── save_15m_stock_data_to_sql()    # 保存15分钟数据
├── save_1m_to_daily()              # 转换为日线数据
└── update_download_status()        # 更新状态
```

## 5.3 15分钟数据处理

### 处理类型

1. **仅重采样**：1分钟 → 15分钟
2. **重采样 + 标准化**：+ Z-score标准化
3. **完整处理**：+ 信号计算

### 数据存储路径

```
data/data/15m/股票代码.csv                 # 15分钟原始数据
data/data/15m_standardized/股票代码.csv    # 15分钟标准化数据
data/data/quarters/年份/季度/股票代码.csv  # 1分钟数据（按季度）
```

---

# 六、数据库设计

## 6.1 核心表

| 表名 | 说明 |
|------|------|
| stock_market_data | 股票基本信息 |
| stock_1m_{year} | 1分钟K线数据 |
| stock_15m_{year} | 15分钟K线数据 |
| stock_daily | 日线数据 |
| rnn_model.TrainRecord | RNN训练记录 |
| rnn_model.RunRecord | RNN运行记录 |
| record_stock_pool | 股票池 |
| trade_records | 交易记录 |
| positions | 持仓管理 |
| users | 用户表 |
| roles | 角色表 |
| permissions | 权限表 |

## 6.2 K线表字段

```
基础字段：date, open, close, high, low, volume, money
MACD字段：EmaShort, EmaMid, EmaLong, Dif, DifSm, DifMl, Dea, MACD
布林带：  BollMid, BollStd, BollUp, BollDn, StopLoss
信号：    Signal, SignalChoice, SignalTimes, SignalStartIndex
周期：    CycleLengthMax, CycleAmplitudeMax, etc.
```

---

# 七、Web应用架构

## 7.1 Flask蓝图

| 蓝图 | 功能 |
|------|------|
| main_bp | 主页面 |
| dl_bp | 数据下载 |
| rnn_bp | RNN模型管理 |
| auth_bp | 用户认证 |
| trading_bp | 交易执行 |
| stock_pool_bp | 股票池管理 |
| process_data_bp | 数据处理 |

## 7.2 页面路由

| 路由 | 页面 |
|------|------|
| `/` | 首页仪表板 |
| `/dl` | 数据下载管理 |
| `/rnn` | RNN模型管理 |
| `/process_data/15m_data` | 15分钟数据处理 |
| `/auth/login` | 登录页面 |
| `/api/*` | RESTful API |

## 7.3 Plotly交互式图表

系统使用Plotly生成5个交互式图表：

1. **价格走势与交易信号**：K线图 + 买卖信号标记
2. **MACD指标分析**：DIF线、DEA线、MACD柱状图
3. **布林带指标分析**：价格 + 上中下轨 + 填充区域
4. **成交量分析**：成交量柱状图 + Daily1mVolMax系列
5. **EMA均线分析**：收盘价 + 短中长期EMA

---

# 八、用户认证系统

## 8.1 认证流程

```
用户 → 输入凭据 → 认证服务 → 查询数据库 → 验证密码 → 生成JWT Token → 返回
```

## 8.2 数据库表

### 用户表 (users)
```sql
id, username, email, password_hash, full_name, phone, avatar_url,
status, email_verified, phone_verified,
failed_login_attempts, locked_until, last_login_at, last_login_ip,
created_at, updated_at, deleted_at
```

### 角色表 (roles)
```sql
id, role_name, role_code, description, is_system, created_at, updated_at
```

### 权限表 (permissions)
```sql
id, permission_name, permission_code, resource_type, description, created_at
```

## 8.3 默认角色

| 角色 | 权限说明 |
|-----|---------|
| 超级管理员 | 拥有所有权限 |
| 管理员 | 系统管理权限 |
| 高级用户 | 所有数据和交易功能 |
| 普通用户 | 基础查看功能 |
| 游客 | 仅查看公开数据 |

## 8.4 使用装饰器

```python
from App.utils.auth_decorators import login_required, permission_required

@route('/start_download', methods=['POST'])
@login_required
@permission_required('stock.data.download')
def start_download():
    pass
```

## 8.5 安全机制

- 密码加密存储 (werkzeug)
- JWT Token认证
- 登录失败5次后锁定30分钟
- Redis缓存Token
- 操作审计日志

---

# 九、改进建议

## 9.1 安全性问题 (高优先级)

| 问题 | 风险 | 状态 |
|------|------|------|
| config.py 包含数据库密码 | 敏感信息泄露 | ✅ 已解决 (secrets.py + .env) |
| Cookie 硬编码在配置中 | 凭据暴露 | ✅ 已解决 (环境变量) |
| 无输入验证 | 注入攻击 | 待处理 |

## 9.2 架构优化 (中优先级)

| 问题 | 状态 |
|------|------|
| 模块命名不统一 | 部分完成 |
| 部分代码重复 | ✅ 已解决 (Normal.py拆分) |
| 缺少依赖管理 | ✅ 已解决 (requirements.txt) |
| 缺少单元测试 | ✅ 已解决 (pytest框架) |
| 缺少日志规范 | 待处理 |
| 大文件难维护 | ✅ 已解决 (RnnRunModel/DlEastMoney拆分) |
| 缺少Repository层 | ✅ 已解决 (repositories/) |
| Services空壳 | ✅ 已解决 (risk/report实现) |

## 9.3 模型改进 (中优先级)

| 问题 | 建议 |
|------|------|
| 仅使用CNN架构 | 尝试 LSTM/GRU/Transformer |
| 学习率固定 | 使用学习率调度器 |
| 缺少早停机制 | 添加 EarlyStopping 回调 |
| 模型评估单一 | 增加 MAE、R2 等指标 |
| 缺少交叉验证 | 添加时间序列交叉验证 |

## 9.4 数据处理改进 (低优先级)

| 问题 | 建议 |
|------|------|
| 数据存储分散 | 统一数据存储路径管理 |
| 缺少数据版本控制 | 考虑使用 DVC |
| 重采样逻辑分散 | 抽取为统一的数据管道 |

## 9.5 交易系统改进 (低优先级)

| 问题 | 建议 |
|------|------|
| GUI自动化不稳定 | 考虑接入券商API |
| 缺少风控机制 | 添加止损/止盈/仓位管理 |
| 无回测系统 | 集成 backtrader 等回测框架 |
| 无实时监控 | 添加交易监控告警 |

## 9.6 性能优化建议

### 数据库优化
- 按年份/季度分表存储K线数据
- 为常用查询字段创建索引
- 使用连接池管理数据库连接

### 异步处理
- 使用 Celery + Redis 实现异步任务队列
- 数据下载和模型训练异步处理

### 缓存策略
- Redis缓存热点数据
- 技术指标计算结果缓存

## 9.7 开发规范 (低优先级)

| 问题 | 建议 |
|------|------|
| 缺少类型注解 | 添加 Type Hints |
| 缺少文档字符串 | 添加 docstring |
| 代码风格不一致 | 使用 Black + isort 格式化 |
| 无 CI/CD | 配置 GitHub Actions |

---

# 十、总结

Stock_RNN 是一个功能完整的量化交易系统，具备：

- **7个数据下载器** - 多源数据保障
- **2个深度学习模型** - 价格预测 + 趋势识别
- **3套技术指标** - MACD、布林带、周期分析
- **完整Web界面** - Flask + 可视化图表
- **用户认证系统** - JWT + RBAC权限控制
- **自动交易执行** - GUI自动化实现

主要改进方向：
1. **安全性**：敏感信息管理
2. **可维护性**：代码规范和测试
3. **模型效果**：架构升级和评估完善
4. **交易可靠性**：API对接和风控系统

---

## 9.8 v3.0 重构总结

### 已完成改进

| 阶段 | 内容 | 状态 |
|------|------|------|
| 阶段一 | 敏感信息迁移到环境变量 | ✅ |
| 阶段一 | 创建 requirements.txt | ✅ |
| 阶段二 | 统一 ServiceResponse 格式 | ✅ |
| 阶段二 | 实现 RiskService/ReportService | ✅ |
| 阶段三 | 拆分 Normal.py (476行→4个模块) | ✅ |
| 阶段三 | 创建 PathManager 统一路径管理 | ✅ |
| 阶段四 | 拆分 RnnRunModel.py (916行→6个模块) | ✅ |
| 阶段四 | 拆分 DlEastMoney.py (1695行→5个模块) | ✅ |
| 阶段四 | 创建 Repository 数据访问层 | ✅ |
| 阶段五 | 删除冗余代码 | ✅ |
| 阶段五 | 创建 pytest 单元测试框架 | ✅ |
| 阶段五 | 更新项目架构文档 | ✅ |

### 架构改进对比

| 指标 | v2.0 | v3.0 |
|------|------|------|
| 最大单文件行数 | 1695行 | ~400行 |
| 敏感信息硬编码 | 有 | 无 |
| 单元测试 | 无 | 有 |
| Repository层 | 无 | 有 |
| 统一响应格式 | 无 | 有 |
| 依赖管理文件 | 无 | 有 |

---

*文档版本: v3.0 (重构版)*
*整合时间: 2026-01-01*
